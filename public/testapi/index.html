<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Daftar Program Kursus</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto">
      <header class="mb-10 text-center">
        <h1 class="text-4xl font-bold text-gray-800">Program Tersedia</h1>
        <p class="text-gray-600 mt-2">
          Pilih program yang sesuai dengan kebutuhan Anda
        </p>
      </header>

      <div id="loading" class="text-center text-xl font-semibold">
        Memuat program...
      </div>

      <div
        id="program-container"
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"
      ></div>
    </div>

    <script>
      // 1. Definisikan BASE_URL server online Anda
      const BASE_URL = "https://admin.kursusbahasa.org";
      const API_URL = `${BASE_URL}/api/programs`;

      async function fetchPrograms() {
        try {
          // Gunakan header agar server tahu kita meminta JSON
          const response = await fetch(API_URL, {
            method: "GET",
            headers: {
              Accept: "application/json",
            },
          });

          if (!response.ok) throw new Error("Respon server tidak ok");

          const result = await response.json();

          if (result.status) {
            renderPrograms(result.data);
          } else {
            document.getElementById("loading").innerText =
              "Data program kosong.";
          }
        } catch (error) {
          console.error("Error fetching data:", error);
          document.getElementById("loading").innerText =
            "Gagal memuat data (CORS atau Server Error).";
        } finally {
          document.getElementById("loading").classList.add("hidden");
        }
      }

      function renderPrograms(programs) {
        const container = document.getElementById("program-container");
        if (!programs || programs.length === 0) {
          container.innerHTML =
            "<p class='text-center col-span-3'>Tidak ada program aktif.</p>";
          return;
        }

        container.innerHTML = programs
          .map((program) => {
            // 2. Sesuaikan path gambar ke BASE_URL server
            const imageSrc = program.thumbnails
              ? `${BASE_URL}/uploads/programs/${program.thumbnails}`
              : `${BASE_URL}/uploads/programs/default.jpg`;

            return `
                <div class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-all border border-gray-200">
                    <img class="h-48 w-full object-cover" 
                         src="${imageSrc}" 
                         alt="${program.title}"
                         onerror="this.src='https://placehold.co/600x400?text=No+Image'">
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-2">
                            <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded uppercase">
                                ${program.category}
                            </span>
                            <span class="text-green-600 font-bold">
                                Rp ${parseInt(program.tuition).toLocaleString("id-ID")}
                            </span>
                        </div>
                        <h2 class="text-xl font-bold text-gray-900 mb-2">${program.title}</h2>
                        <p class="text-gray-600 text-sm mb-4 line-clamp-2">${program.description || ""}</p>
                        
                        <div class="flex items-center text-gray-500 text-xs mb-4">
                            <span class="mr-3">‚è± ${program.duration || "-"}</span>
                            <span>üìç ${program.classtype || "-"}</span>
                        </div>

                        <a href="detail.html?id=${program.id}" 
                           class="block text-center bg-blue-600 text-white py-2 rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                            Lihat Detail
                        </a>
                    </div>
                </div>
                `;
          })
          .join("");
      }

      fetchPrograms();
    </script>
  </body>
</html>
